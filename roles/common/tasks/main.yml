---
# This role contains common plays that will run on all nodes.

- name: Raw bootstrap for python
  raw: yum -y install python libselinux-python

- name: Create the repository for EPEL
  copy: src=epel.repo dest=/etc/yum.repos.d/epel.repo

- name: Create the GPG key for EPEL
  copy: src=RPM-GPG-KEY-EPEL-6 dest=/etc/pki/rpm-gpg

- name: remove some useless packages
  yum: name={{ item }} state=absent
  with_items:
  - puppet
  - chef
  
- name: yum update all the things
  yum: name=* state=latest

- name: add routes
  template: src=ifcfg-eth1.j2 dest=/etc/sysconfig/network-scripts/ifcfg-eth1

- name: turn off eth0
  template: src=ifcfg-eth0.j2 dest=/etc/sysconfig/network-scripts/ifcfg-eth0

- name: restart machine 
  command: shutdown -r now "Ansible updates triggered"
  async: 0
  poll: 0
  ignore_errors: true

- name: waiting for server to come back
  pause: seconds=30

- name: set up authorized keys for demo boxes
  authorized_key: user=vagrant key="{{ lookup('file', 'id_rsa.pub') }}"
    manage_dir=yes state=present 

- name: fix permissions
  shell: sudo chown -R vagrant.vagrant /home/vagrant
